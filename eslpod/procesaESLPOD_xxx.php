<?php
//error_reporting(E_ALL);
//ini_set("display_errors", 1);

//mp3cut -o 01_ESL289.mp3 -t 1:24-3:18 ESLPod289.mp3
   
//$page = file_get_contents('https://www.eslpod.com/website/show_podcast.php?issue_id=19021161');

//Creates a blank array.
$id_podcast = array();

//Creates an array with elements.
$id_podcast = array("1988802","1998745","2008688","2018631","2078289","2068346","2137947","2147890","2157833","2167776","2177719","2187662","2237377","2247320","2257263","2267206","2277149","2287092","2297035","2306978","2316921","2356693","2366636","2376579","2386522","2396465","2515781","2525724","2535667","2545610","2555553","2565496","2575439","2585382","2595325","2605268","2615211","2625154","2645040","2654983","2674869","2684812","2694755","2704698","2734527","2744470","2754413","2764356","2794185","2804128","2824014","2833957","3012931","3022874","2963216","2973159","2993045","3002988","3042760","3052703","3062646","3072589","3191905","3201848","3112361","3122304","3152133","3132247","3162076","3172019","3221734","3231677","3251563","3261506","3291335","3301278","3321164","3331107","3350993","3360936","3380822","3390765","3420594","3410651","3440480","3450423","3470309","3480252","3510081","3520024","3529967","3539910","3569739","3579682","3589625","3599568","3619454","3629397","3649283","3659226","3679112","3689055","3708941","3718884","3738770","3748713","3768599","3778542","3808371","3818314","3828257","3838200","3858086","3868029","3897858","3907801","3927687","3937630","3957516","3967459","3987345","3997288","4017174","4027117","4047003","4056946","4076832","4086775","4106661","4116604","4156376","4136490","4146433","4196148","4206091","4216034","4245863","4255806","4265749","4275692","4315464","4325407","4335350","4345293","4355236","4365179","4385065","4395008","4414894","4424837","4474552","4484495","4494438","4504381","4514324","4524267","4544153","4554096","4583925","4593868","4603811","4613754","4653526","4663469","4673412","4683355","4693298","4703241","4733070","4743013","4752956","4762899","4772842","4782785","4792728","4802671","4812614","4822557","4832500","4842443","4941873","4951816","4961759","4971702","4981645","4991588","5001531","5011474","5061189","5071132","5081075","5091018","5120847","5130790","5140733","5150676","5170562","5180505","5200391","5210334","5220277","5230220","5250106","5260049","5289878","5299821","5329650","5339593","5349536","5359479","5389308","5399251","5409194","5419137","5468852","5478795","5488738","5498681","5508624","5518567","5528510","5538453","5578225","5588168","5598111","5608054","5617997","5627940","5647826","5657769","5697541","5707484","5717427","5727370","5737313","5747256","5777085","5787028","5796971","5806914","5826800","5836743","5856629","5866572","5886458","5896401","5916287","5926230","5936173","5946116","5985888","6005774","6015717","6035603","6045546","6065432","6075375","6095261","6105204","6125090","6135033","6154919","6174805","6194691","6204634","6224520","6234463","6254349","6264292","6284178","6294121","6314007","6323950","6343836","6353779","6373665","6383608","6403494","6413437","6433323","6443266","6463152","6473095","6492981","6512867","6532753","6552639","6572525","6582468","6602354","6612297","6632183","6642126","6662012","6671955","6691841","6701784","6721670","6751499","6771385","6781328","6801214","6811157","6831043","6840986","6860872","7000074","7019960","7029903","7049789","7059732","7079618","7109447","7129333","7159162","7179048","7188991","7208877","7218820","7238706","7248649","7268535","7288421","7308307","7318250","7338136","7348079","7367965","7377908","7397794","7407737","7427623","7437566","7457452","7467395","7487281","7497224","7517110","7527053","7546939","7556882","7576768","7586711","7606597","7616540","7636426","7646369","7666255","7676198","7696084","7706027","7725913","7735856","7755742","7765685","7785571","7795514","7815400","7825343","7845229","7855172","7875058","7885001","7904887","7914830","7934716","7944659","7964545","7974488","7994374","8004317","8024203","8034146","8054032","8063975","8083861","8093804","8113690","8123633","8143519","8153462","8173348","8183291","8203177","8213120","8233006","8242949","8262835","8272778","8292664","8302607","8322493","8332436","8352322","8362265","8382151","8392094","8411980","8421923","8441809","8451752","8471638","8481581","8501467","8511410","8531296","8541239","8561125","8571068","8590954","8600897","8620783","8630726","8650612","8660555","8680441","8690384","8710270","8720213","8740099","8750042","8769928","8779871","8799757","8809700","8829586","8869358","8859415","8889244","8899187","8929016","8938959","8948902","8958845","8978731","8988674","9018503","9028446","9038389","9048332","9068218","9078161","9098047","9117933","9127876","9147762","9167648","9187534","9197477","9217363","9227306","9247192","9257135","9277021","9286964","9306850","9316793","9336679","9346622","9366508","9376451","9396337","9406280","9426166","9436109","9455995","9465938","9485824","9495767","9515653","9525596","9545482","9555425","9575311","9585254","9605140","9615083","9634969","9644912","9664798","9674741","9694627","9704570","9724456","9734399","9754285","9764228","9784114","9794057","9813943","9823886","9843772","9853715","9873601","9883544","9903430","9913373","9933259","9943202","9963088","9973031","9992917","10002860","10022746","10032689","10052575","10062518","10082404","10092347","10112233","10122176","10142062","10152005","10161948","10181834","10201720","10211663","10231549","10241492","10261378","10271321","10291207","10301150","10321036","10330979","10340922","10370751","10390637","10400580","10420466","10430409","10450295","10460238","10480124","10490067","10509953","10519896","10539782","10549725","10569611","10579554","10599440","10609383","10629269","10639212","10659098","10669041","10688927","10698870","10718756","10728699","10748585","10768471","10778414","10808243","10818186","10877844","10857958","10848015","10867901","10907673","10917616","10927559","10947445","10977274","10987217","11007103","11017046","11066761","11076704","11046875","11056818","11096590","11106533","11146305","11156248","11176134","11166191","11196020","11205963","11225849","11235792","11265621","11275564","11285507","11295450","11325279","11335222","11345165","11355108","11365051","11374994","11384937","11394880","11444595","11454538","11484367","11494310","11504253","11514196","11544025","11553968","11563911","11573854","11603683","11613626","11623569","11633512","11663341","11673284","11683227","11693170","11742885","11752828","11762771","11772714","11782657","11792600","11802543","11812486","11842315","11852258","11862201","11872144","11892030","11901973","11911916","11921859","11971574","11981517","11991460","12001403","12011346","12021289","12041175","12051118","12061061","12071004","12130662","12140605","12200263","12210206","12150548","12160491","12170434","12180377","12240035","12249978","12259921","12269864","12299693","12329522","12339465","12349408","12369294","12379237","12409066","12419009","12428952","12438895","12458781","12468724","12498553","12508496","12647698","12657641","12548268","12558211","12518439","12528382","12588040","12597983","12607926","12617869","12687470","12697413","12707356","12717299","12747128","12757071","12767014","12776957","12806786","12816729","12826672","12836615","12866444","12876387","12886330","12896273","12916159","12926102","12955931","12965874","12975817","12985760","13005646","13015589","13035475","13045418","13065304","13075247","13095133","13105076","13124962","13144848","13303936","13313879","13164734","13174677","13194563","13204506","13353651","13363594","13224392","13234335","13254221","13264164","13284050","13293993","13373537","13393423","13413309","13423252","13443138","13453081","13472967","13482910","13502796","13512739","13552511","13562454","13582340","13592283","13602226","13612169","13641998","13632055","13661884","13671827","13701656","13711599","13731485","13741428","13761314","13771257","13791143","13801086","13830915","13840858","13850801","13860744","13900516","13910459","13950231","13960174","13970117","13980060","13990003","13999946","14019832","14029775","14049661","14059604","14089433","14099376","14109319","14119262","14139148","14149091","14168977","14178920","14198806","14208749","14228635","14238578","14268407","14278350","14288293","14298236","14318122","14328065","14338008","14347951","14377780","14387723","14417552","14437438","14447381","14457324","14467267","14477210","14497096","14507039","14536868","14546811","14556754","14566697","14586583","14596526","14616412","14626355","14646241","14656184","14666127","14676070","14715842","14725785","14735728","14745671","14765557","14775500","14805329","14835158","14815272","14825215","14855044","14864987","14894816","14904759","14914702","14924645","14954474","14964417","14974360","14984303","15024075","15034018","15043961","15053904","15063847","15073790","15103619","15113562","15123505","15133448","15153334","15163277","15193106","15203049","15212992","15222935","15252764","15262707","15272650","15282593","15302479","15312422","15332308","15342251","15362137","15372080","15391966","15401909","15431738","15441681","15451624","15461567","15481453","15491396","15521225","15531168","15541111","15551054","15580883","15590826","15600769","15610712","15650484","15660427","15670370","15680313","15690256","15700199","15720085","15730028","15769800","15779743","15789686","15799629","15809572","15819515","15849344","15859287","15869230","15879173","15889116","15899059","15938831","15948774","15958717","15968660","15978603","15988546","16028318","16038261","16048204","16058147","16097919","16107862","16117805","16127748","16137691","16147634","16167520","16177463","16217235","16227178","16237121","16247064","16257007","16266950","16286836","16296779","16326608","16336551","16346494","16356437","16386266","16396209","16406152","16416095","16455867","16465810","16475753","16485696","16495639","16505582","16535411","16545354","16585126","16595069","16624898","16634841","16644784","16654727","16704442","16714385","16724328","16734271","16744214","16754157","16764100","16774043","16813815","16823758","16833701","16843644","16873473","16883416","16893359","16903302","16933131","16943074","16953017","16962960","16982846","16992789","17022618","17032561","17042504","17052447","17092219","17102162","17112105","17122048","17131991","17141934","17161820","17171763","17211535","17221478","17241364","17231421","17251307","17261250","17301022","17310965","17320908","17330851","17340794","17350737","17380566","17390509","17400452","17410395","17440224","17450167","17460110","17470053","17509825","17519768","17529711","17539654","17609255","17619198","17629141","17639084","17649027","17658970","17668913","17678856","17708685","17718628","17728571","17738514","17768343","17778286","17788229","17798172","17808115","17818058","17867773","17877716","17887659","17897602","17907545","17917488","17947317","17957260","17967203","17977146","18036804","18046747","18056690","18066633","18076576","18086519","18116348","18126291","18136234","18146177","18195892","18205835","18215778","18225721","18235664","18245607","18255550","18265493","18305265","18315208","18325151","18335094","18345037","18354980","18384809","18394752","18404695","18414638","18434524","18444467","18553840","18543897","18533954","18524011","18514068","18504125","18573726","18583669","18613498","18623441","18633384","18643327","18673156","18683099","18693042","18702985","18742757","18752700","18762643","18772586","18782529","18792472","18812358","18822301","18842187","18852130","18862073","18872016","18911788","18921731","18931674","18941617","18991332","19001275","19011218","19021161","19031104","19041047","19070876","19080819","19090762","19100705","18921731","18931674","18941617","18991332","19001275","19011218","19021161","19031104","19041047","19070876","19080819","19090762","19100705","17887659","17897602","17907545","17917488","17947317","17957260","17967203","17977146","18036804","18046747","18056690","18066633","18076576","18086519","18116348","18126291","18136234","18146177","18195892","18205835","18215778","18225721","18235664","18245607","18255550","18265493","18305265","18315208","18325151","18335094","18345037","18354980","18384809","18394752","18404695","18414638","18434524","18444467","18553840","18543897","18533954","18524011","18514068","18504125","18573726","18583669","18613498","18623441","18633384","18643327","18673156","18683099","18693042","18702985","18742757","18752700","18762643","18772586","18782529","18792472","18812358","18822301","18842187","18852130","18862073","18872016","18911788","18921731","18931674","18941617","18991332","19001275","19011218","19021161","19031104","19041047","19070876","19080819","19090762","19100705","18921731","18931674","18941617","18991332","19001275","19011218","19021161","19031104","19041047","19070876","19080819","19090762","19100705");


$base_page="https://www.eslpod.com/website/show_podcast.php?issue_id=";


foreach ($id_podcast as &$valor_id) {


$page = iconv('UTF-8', 'UTF-8//IGNORE',file_get_contents($base_page."".$valor_id));

$doc = new DOMDocument;
$doc->loadHTML($page);
$doc->formatOutput = true;
$doc->normalizeDocument();


$divs = $doc->getElementsByTagName('table');
$titles = $doc->getElementsByTagName('b');



foreach($titles as $title) {
    if ($title->getAttribute('class') === 'pod_title') {
        $title_pod=$title->nodeValue;    
       } 
}

$title_pod=str_replace("ESL Podcast ","",$title_pod);


$temp_dom0 = new DOMDocument();
$temp_dom1 = new DOMDocument();

$i=0;

foreach($divs as $div) {

    if ($div->getAttribute('class') === 'podcast_table_home') {
	if ($i == 0) $temp_dom0->appendChild($temp_dom0->importNode($div,TRUE)) ;
	if ($i == 1) $temp_dom1->appendChild($temp_dom1->importNode($div,TRUE)) ;
	$i=$i+1; 
       } 

}


$texto= str_replace("<b>","**",$temp_dom1->saveHTML());
$texto= str_replace("</b>","**",$texto);
$texto = preg_replace('/\s+/', ' ', $texto);
$texto = str_replace('  ', ' ', $texto);
$texto= str_replace("<br>","<br>\n",$texto);






$dom = new DOMDocument;
$dom->loadHTML($page);
foreach ($dom->getElementsByTagName('a') as $node)
{
	if (preg_match("/mp3/",$node->getAttribute('href'))== 1){
	  $link=$node->getAttribute("href");
	}
}




$file= explode("/", $link);

$time = $temp_dom0->textContent;
$time = preg_replace('/\s+/', ' ', $time);
$time= str_replace('  ', ' ', $time);
$time= str_replace("Audio Index:","mp3cut -o newfile.mp3",$time);
$time= str_replace("Slow dialog:","-t",$time);
$time= str_replace(" Explanations: ","-",$time);
$time= str_replace("Fast dialog:","oldfile.mp3 ; ",$time);

$time= str_replace("newfile.mp3","rec_".$file[4],$time);
$time= str_replace("oldfile.mp3","".$file[4],$time);

$time = preg_replace('/;.*$/', ' ', $time);


echo trim($title_pod."\n");
echo "\n--------------------------------------\n";
print_r ($texto);

$fp0 = fopen('textos.md', 'a+');
fwrite($fp0,trim("\n".$title_pod."\n"));
fwrite($fp0,"\n--------------------------------------\n");
fwrite($fp0,trim(strip_tags($texto)));
fwrite($fp0,"\n");
fclose($fp0);


$fp1 = fopen('comandos.txt', 'a+');
fwrite($fp1,"\nwget ".$link."\n");
fwrite($fp1,trim($time));
fwrite($fp1,"\n");
fclose($fp1);

} // Fin del for each del principio 
 
?>
